<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<!-- 强制禁止缩放，锁定视口 -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>给宝宝的小情书(◕ᴗ◕✿)</title>
<style>
  /* --- 1. 基础重置 --- */
  * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  
  html, body {
    width: 100%;
    height: 100%;
    overflow: hidden; /* 禁止滚动 */
    background: radial-gradient(circle at center, #1a1c29 0%, #000000 100%);
    font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", sans-serif;
    position: fixed; /* 锁定屏幕 */
    inset: 0;
  }

  /* --- 2. 烟花层 --- */
  #fireworksCanvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1;
    pointer-events: none;
  }

  /* --- 3. 弹窗卡片 (手机版优化) --- */
  .window-card {
    position: absolute; /* 改为 absolute 配合容器 */
    width: 100px; /* 稍微调小一点适应手机 */
    background: rgba(20, 20, 25, 0.8);
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
    border: 1px solid #fff; 
    border-radius: 8px;
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.1);
    transition: opacity 0.3s, transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    z-index: 10;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    /* 解决手机点击穿透问题 */
    touch-action: none; 
  }

  /* 出现动画类 */
  .window-card.show {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }

  .card-header {
    height: 22px;
    background: rgba(255, 255, 255, 0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 6px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }
  
  .close-btn { font-size: 16px; width: 20px; text-align: center; color: #ccc; }

  .card-body {
    padding: 8px 6px;
    font-size: 10px; /* 字体改小一点防止溢出 */
    color: #fff;
    line-height: 1.4;
    min-height: 36px;
    display: flex;
    align-items: center;
    pointer-events: none;
  }

  /* 激活状态 */
  .window-card.active {
    z-index: 99999 !important;
    transform: translate(-50%, -50%) scale(1.5) !important;
    background: rgba(0, 0, 0, 0.95);
    border-width: 2px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.8);
  }

  /* --- 4. 底部控制区 (重构) --- */
  .controls-container {
    position: fixed;
    bottom: 30px; /* 距离底部 */
    left: 0;
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-end;
    z-index: 200000;
    pointer-events: none; /* 让容器不挡手，只让按钮挡手 */
  }

  /* 展开的菜单栏 (横向排列) */
  .menu-bar {
    display: flex;
    gap: 15px;
    margin-bottom: 15px;
    opacity: 0;
    transform: translateY(20px) scale(0.8);
    transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
    pointer-events: none; /* 隐藏时不可点 */
  }

  .controls-container.open .menu-bar {
    opacity: 1;
    transform: translateY(0) scale(1);
    pointer-events: auto;
  }

  /* 霓虹按钮样式 (参考你的截图) */
  .neon-btn {
    width: 50px;
    height: 50px;
    border-radius: 12px;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(10px);
    border: 1.5px solid;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: #fff;
    font-size: 10px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    pointer-events: auto;
  }
  
  .neon-btn:active { transform: scale(0.9); }
  .icon { font-size: 18px; margin-bottom: 2px; }

  /* 颜色定义 */
  .btn-start { border-color: #00ffcc; color: #00ffcc; box-shadow: 0 0 8px rgba(0,255,204,0.2); }
  .btn-scatter { border-color: #ffcc00; color: #ffcc00; box-shadow: 0 0 8px rgba(255,204,0,0.2); }
  .btn-clear { border-color: #ff3366; color: #ff3366; box-shadow: 0 0 8px rgba(255,51,102,0.2); }

  /* 主爱心开关 */
  .toggle-heart {
    width: 50px;
    height: 50px;
    background: linear-gradient(135deg, #fc6767, #ec008c);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    color: white;
    box-shadow: 0 5px 20px rgba(236, 0, 140, 0.5);
    border: 2px solid rgba(255,255,255,0.8);
    pointer-events: auto;
    cursor: pointer;
    transition: transform 0.3s;
    animation: pulse 2s infinite;
  }
  
  .controls-container.open .toggle-heart {
    transform: rotate(45deg); /* 变成关闭X */
    background: #333;
    border-color: #666;
    animation: none;
    box-shadow: none;
  }

  @keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
  }

</style>
</head>
<body>

<canvas id="fireworksCanvas"></canvas>

<!-- 音乐：必须确保文件名正确 -->
<audio id="bgMusic" loop>
  <source src="岳燃-慢慢.mp3" type="audio/mpeg">
  <!-- 备用链接，防止本地没文件时不响 -->
  <source src="https://music.163.com/song/media/outer/url?id=1901371647.mp3" type="audio/mpeg">
</audio>

<!-- 底部控制组件 -->
<div class="controls-container" id="controls">
  <!-- 展开的三个按钮 -->
  <div class="menu-bar">
    <div class="neon-btn btn-start" onclick="startShow()">
      <span class="icon">▶</span>
      <span>开始</span>
    </div>
    <div class="neon-btn btn-scatter" onclick="scatterCards()">
      <span class="icon">✨</span>
      <span>散落</span>
    </div>
    <div class="neon-btn btn-clear" onclick="clearAll()">
      <span class="icon">×</span>
      <span>清除</span>
    </div>
  </div>
  
  <!-- 主爱心按钮 -->
  <div class="toggle-heart" onclick="toggleMenu()">♥</div>
</div>

<script>
// --- 1. 文案数据 ---
const textData = [
  "慢慢的习惯身边有你的温暖", "晚安，梦里见", "今天有没有一点点想我", "天气变凉了，记得加衣", "不仅要早睡，还要睡得香",
  "想和你分享今天发生的趣事", "你现在的表情是不是很可爱", "刚才看到一个背影好像你", "你的名字是我最短的情诗",
  "别总喝冰的，对胃不好", "记得按时吃饭，不许挑食", "想钻进你的屏幕里", "如果你在就好了", "好想捏捏你的脸",
  "今晚的月亮很美，像你一样", "收到你的消息会偷笑", "别熬夜，我会心疼", "你的声音真的很好听", "想做你的偏爱和例外",
  "我们在慢慢变好，对吗", "任何时候都可以找我", "我一直在你身后", "别皱眉，会变丑哦", "想和你去吹晚风",
  "想和你去吃火锅", "想和你去看海", "想和你去迪士尼", "你是我藏不住的欢喜", "我的猫想你了，其实我也...",
  "能不能分一点时间给我", "遇见你花光了我所有运气", "你是我心动的理由", "想被你坚定地选择", "别让我等太久",
  "我是不是你最重要的人", "你在我心里位置很特殊", "听到这首歌就想起了你", "你是我不想错过的风景", "好想突然出现在你面前",
  "给个机会让我照顾你", "你是我每天醒来的动力", "想和你一起虚度光阴", "慢慢来，我等你", "只要是你，晚一点没关系",
  "在我面前可以做小孩子", "难过的时候记得告诉我", "快乐的时候也记得告诉我", "我想参与你的生活", "你的过去我来不及",
  "你的未来我想奉陪", "你稍微走一步，剩下的我走", "好想牵你的手", "想感受你手心的温度", "想抱你很久很久",
  "你是我睡前的最后一个念头", "也是我醒来的第一个念头", "如果我们在一起...", "我不甘心只做朋友", "想越过那条线",
  "你能不能看我一眼", "我很乖的", "能不能夸夸我", "我想被你哄", "想被你宠坏", "你是我无法抗拒的引力",
  "想和你一起发呆", "你是我在这个世界的糖", "有点苦的时候就想你", "你是我的解药", "明明没在一起却在吃醋",
  "看到你和别人说话会不爽", "我是不是太贪心了", "只想把你占为己有", "你是我的私有浪漫", "不许对别人笑",
  "只准对我好", "霸道一点行不行", "温柔一点行不行", "怎样你才肯喜欢我", "我已经走了九十九步", "最后一步你肯走吗",
  "好怕最后不是你", "好怕最后没有你", "想把星星摘给你", "但星星没你眼睛亮", "能不能收留我", "我很好养的",
  "只要一点点爱", "一点点关心", "你是我的星辰大海", "你是我的遥不可及", "你是我的触手可及", "别让我猜了好不好",
  "直球一点好不好", "想和你过春夏秋冬", "想和你过一日三餐", "你是我的心之所向", "你是我的情有独钟",
  "我在等你的回响", "如果你回头，我一定在", "一直都在", "不管多久，不管多远", "只要你招手", "我就飞奔而去",
  "真的好喜欢你", "今天也是元气满满的一天", "照顾好自己", "多喝温水", "出门记得带伞", "注意安全",
  "到家告诉我", "别太累了", "休息一下吧", "眼睛酸不酸", "坐姿要端正", "不要总是低头玩手机",
  "想给你做饭", "想给你吹头发", "想给你洗水果", "想接你下班", "想送你回家", "别怕麻烦我",
  "你的事就是我的事", "随时为你有空", "消息秒回你", "电话秒接", "哪怕不说话", "待在一起就好",
  "有你在就安心", "你是我的定心丸", "只要你需要，我就出现", "不会让你找不到", "给足你安全感", "不让你猜疑",
  "有什么直接说", "我们要好好的", "多沟通", "互相包容", "彼此信任", "共同进步", "一起变好",
  "你是我的动力", "想给你一个家", "每天都要快乐", "烦心事退退退", "好运爆棚", "万事胜意",
  "平安喜乐", "百毒不侵", "做个快乐的小猪", "无忧无虑", "天真烂漫", "晚安我的宝", "早安我的爱",
  "午安休息好", "时刻把你放心上", "爱你哦", "别老是看电脑", "记得滴眼药水", "指甲该剪啦",
  "房间通风了吗", "多晒晒太阳", "不要为了减肥不吃", "健康最美", "我喜欢肉肉的你", "不许说自己胖",
  "今天想吃啥", "我给你点外卖", "出门记得带钥匙", "身份证带了吗", "手机有电吗", "带充电宝",
  "别去危险的地方", "不要相信陌生人", "保护好自己", "我会担心的", "别让我找不到你", "今天有没有想我",
  "我好想你呀", "每时每刻都在想", "连呼吸都在想", "做梦也想你", "我的世界不能没你", "你是我的全部",
  "下辈子也要在一起", "想给你个惊喜", "想看你惊喜的表情", "想把你宠上天", "你就是我的小公主", "女王大人请吩咐",
  "小的随时待命", "别生气啦", "生气容易变老", "笑一个", "再笑一个", "么么哒", "亲亲你",
  "抱紧紧", "举高高", "转圈圈", "想你的风还是吹到了心里", "这世界车水马龙", "只有你让我心动",
  "遇见你之前，我没想过结婚", "遇见你之后，结婚没想过别人", "所有的偶遇都是我蓄谋已久", "想做你的唯一", "想和你在这个星球流浪"
];

const neonColors = ['#ff00cc', '#00ffcc', '#ffcc00', '#00ccff', '#ff6666'];
let cardElements = [];
let createTimer = null;
let zIndexCounter = 1000;

// --- 2. 烟花系统 (优化版) ---
const canvas = document.getElementById('fireworksCanvas');
const ctx = canvas.getContext('2d');
let w = window.innerWidth;
let h = window.innerHeight;
canvas.width = w; canvas.height = h;

window.addEventListener('resize', () => {
  w = window.innerWidth;
  h = window.innerHeight;
  canvas.width = w; canvas.height = h;
});

let particles = [];
class Particle {
  constructor(x, y, color) {
    this.x = x; this.y = y; this.color = color;
    const t = Math.random() * Math.PI * 2;
    const force = Math.random() * 2 + 1;
    // 心形扩散
    const hx = 16 * Math.pow(Math.sin(t), 3);
    const hy = -(13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t));
    this.vx = (hx / 15) * force;
    this.vy = (hy / 15) * force;
    this.gravity = 0.05;
    this.alpha = 1;
    this.decay = 0.015;
  }
  update() {
    this.x += this.vx; this.y += this.vy;
    this.vy += this.gravity;
    this.alpha -= this.decay;
  }
  draw() {
    ctx.save();
    ctx.globalAlpha = this.alpha;
    ctx.globalCompositeOperation = 'lighter';
    ctx.fillStyle = this.color;
    ctx.beginPath();
    ctx.arc(this.x, this.y, 2.5, 0, Math.PI*2);
    ctx.fill();
    ctx.restore();
  }
}

function loop() {
  ctx.globalCompositeOperation = 'destination-out';
  ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
  ctx.fillRect(0, 0, w, h);
  ctx.globalCompositeOperation = 'source-over';
  
  if(Math.random()<0.04) { // 自动放烟花
    const cx = Math.random()*w;
    const cy = Math.random()*h*0.6;
    const col = neonColors[Math.floor(Math.random()*neonColors.length)];
    for(let i=0; i<40; i++) particles.push(new Particle(cx, cy, col));
  }
  
  for(let i=particles.length-1; i>=0; i--) {
    particles[i].update();
    particles[i].draw();
    if(particles[i].alpha<=0) particles.splice(i,1);
  }
  requestAnimationFrame(loop);
}
loop();

// --- 3. 核心：弹窗生成 ---
function startShow() {
  // 1. 尝试播放音乐 (不阻塞后续代码)
  const audio = document.getElementById('bgMusic');
  audio.play().catch(e => console.log('音乐自动播放被拦截，需要用户点击页面:', e));

  // 2. 清理旧的
  clearAll();
  
  // 3. 关闭菜单
  toggleMenu();

  // 4. 准备数据
  let msgs = [...textData];
  while(msgs.length < 200) msgs = msgs.concat(textData);
  msgs = msgs.sort(()=>Math.random()-0.5).slice(0, 200);

  // 5. 计算坐标 (修复手机屏幕计算问题)
  // 获取当前真实的视口中心
  const cx = window.innerWidth / 2;
  const cy = window.innerHeight / 2 - 50; // 稍微向上，留出底部按钮位置

  // 针对手机优化半径：取宽度的 1/35 左右作为基准
  const baseScale = Math.min(window.innerWidth, window.innerHeight) / 38;

  let points = [];
  // 双层爱心：内圈80，外圈120
  [ {c:80, s:0.7}, {c:120, s:1.1} ].forEach(layer => {
    for(let i=0; i<layer.c; i++) {
      const t = (Math.PI*2*i)/layer.c;
      const x = 16 * Math.pow(Math.sin(t), 3);
      const y = -(13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t));
      points.push({
        x: cx + x * baseScale * layer.s,
        y: cy + y * baseScale * layer.s
      });
    }
  });

  // 6. 启动定时器生成
  let idx = 0;
  createTimer = setInterval(() => {
    if(idx >= points.length) { clearInterval(createTimer); return; }
    
    // 加一点点随机偏移，防止完全重叠死板
    const p = points[idx];
    const jitter = 4;
    const fx = p.x + (Math.random()-0.5)*jitter;
    const fy = p.y + (Math.random()-0.5)*jitter;
    
    createWindow(fx, fy, idx, msgs[idx]);
    idx++;
  }, 25);
}

function createWindow(x, y, i, text) {
  const div = document.createElement('div');
  div.className = 'window-card';
  const color = neonColors[i % neonColors.length];
  div.style.borderColor = color;
  div.style.left = x + 'px';
  div.style.top = y + 'px';
  div.style.zIndex = 100 + i;
  
  div.innerHTML = `
    <div class="card-header">
      <span style="color:${color};font-weight:bold;">♥ 碎碎念</span>
      <span class="close-btn">×</span>
    </div>
    <div class="card-body">${text}</div>
  `;
  
  document.body.appendChild(div);
  cardElements.push(div);
  
  // 延时添加 show 类触发 CSS 动画
  setTimeout(() => div.classList.add('show'), 10);
  
  bindTouch(div);
}

// --- 4. 触摸交互 (重点修复) ---
function bindTouch(el) {
  let startX, startY, initX, initY;
  let dragging = false;

  // 1. 关闭逻辑
  const closeBtn = el.querySelector('.close-btn');
  const closeAction = (e) => {
    e.stopPropagation(); // 防止冒泡触发拖拽
    el.style.opacity = 0;
    setTimeout(() => el.remove(), 300);
  };
  closeBtn.addEventListener('click', closeAction);
  closeBtn.addEventListener('touchstart', closeAction, {passive: true});

  // 2. 激活逻辑 (点击置顶)
  const activate = () => {
    zIndexCounter++;
    el.style.zIndex = zIndexCounter;
    el.classList.add('active');
  };
  el.addEventListener('mousedown', activate);
  el.addEventListener('touchstart', activate, {passive: true});

  // 3. 拖拽逻辑 (兼容 Mouse 和 Touch)
  const header = el.querySelector('.card-header');

  const startDrag = (e) => {
    dragging = true;
    activate();
    const pt = e.touches ? e.touches[0] : e;
    startX = pt.clientX;
    startY = pt.clientY;
    initX = el.offsetLeft;
    initY = el.offsetTop;
    
    // 如果是触摸，防止屏幕滚动
    if(e.type === 'touchstart') document.body.style.overflow = 'hidden';
  };

  const moveDrag = (e) => {
    if(!dragging) return;
    const pt = e.touches ? e.touches[0] : e;
    const dx = pt.clientX - startX;
    const dy = pt.clientY - startY;
    el.style.left = (initX + dx) + 'px';
    el.style.top = (initY + dy) + 'px';
    if(e.cancelable) e.preventDefault();
  };

  const endDrag = () => {
    dragging = false;
    document.body.style.overflow = '';
  };

  header.addEventListener('mousedown', startDrag);
  header.addEventListener('touchstart', startDrag, {passive: false});

  window.addEventListener('mousemove', moveDrag);
  window.addEventListener('touchmove', moveDrag, {passive: false});

  window.addEventListener('mouseup', endDrag);
  window.addEventListener('touchend', endDrag);
}

// --- 5. 控制按钮 ---
function toggleMenu() {
  document.getElementById('controls').classList.toggle('open');
}

function clearAll() {
  clearInterval(createTimer);
  cardElements.forEach(el => el.remove());
  cardElements = [];
  document.getElementById('controls').classList.remove('open');
}

function scatterCards() {
  clearInterval(createTimer);
  document.getElementById('controls').classList.remove('open');
  cardElements.forEach(el => {
    const rx = Math.random() * (window.innerWidth - 80) + 40;
    const ry = Math.random() * (window.innerHeight - 100) + 50;
    const rot = (Math.random()-0.5)*30;
    el.style.transition = 'all 0.6s ease';
    el.style.left = rx + 'px';
    el.style.top = ry + 'px';
    el.style.transform = `translate(-50%, -50%) rotate(${rot}deg) scale(1)`;
    el.classList.remove('active');
  });
}

// 点击空白取消高亮
document.addEventListener('touchstart', (e) => {
  if(e.target.tagName === 'CANVAS' || e.target.tagName === 'BODY') {
    document.querySelectorAll('.window-card.active').forEach(d => d.classList.remove('active'));
  }
});

</script>
</body>
</html>
